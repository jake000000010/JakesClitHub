--// Services and Cleanup //--
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer
pcall(function() CoreGui:FindFirstChild("ClitHubUI"):Destroy() end)

--// GUI Root //--
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "ClitHubUI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false

-- Click Sound
local clickSound = Instance.new("Sound", ScreenGui)
clickSound.SoundId = "rbxassetid://15675059323"
clickSound.Volume = 0.3
local function playClick() clickSound:Play() end

-- KEY SYSTEM (Before GUI shows)
local function startMainUI()
    --// Services and Cleanup //--
    local Players = game:GetService("Players")
    local UIS = game:GetService("UserInputService")
    local TweenService = game:GetService("TweenService")
    local CoreGui = game:GetService("CoreGui")
    local RunService = game:GetService("RunService")
    local LP = Players.LocalPlayer
    pcall(function() CoreGui:FindFirstChild("ClitHubUI"):Destroy() end)

    --// GUI Root //--
    local ScreenGui = Instance.new("ScreenGui", CoreGui)
    ScreenGui.Name = "ClitHubUI"
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.ResetOnSpawn = false

    -- Click Sound
    local clickSound = Instance.new("Sound", ScreenGui)
    clickSound.SoundId = "rbxassetid://15675059323"
    clickSound.Volume = 0.3
    local function playClick() clickSound:Play() end

    -- Welcome Screen
    local welcomeFrame = Instance.new("Frame", ScreenGui)
    welcomeFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    welcomeFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    welcomeFrame.Size = UDim2.new(0, 400, 0, 140)
    welcomeFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Instance.new("UICorner", welcomeFrame).CornerRadius = UDim.new(0, 10)

    local shine = Instance.new("ImageLabel", welcomeFrame)
    shine.BackgroundTransparency = 1
    shine.Image = "rbxassetid://13835335945"
    shine.Size = UDim2.new(1, 0, 1, 0)
    shine.ImageTransparency = 0.7

    local welcomeLabel = Instance.new("TextLabel", welcomeFrame)
    welcomeLabel.Size = UDim2.new(0.8, 0, 0.4, 0)
    welcomeLabel.Position = UDim2.new(0.1, 0, 0.3, 0)
    welcomeLabel.BackgroundTransparency = 1
    welcomeLabel.Font = Enum.Font.Code
    welcomeLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
    welcomeLabel.TextScaled = true
    welcomeLabel.Text = ""
    welcomeLabel.TextTransparency = 1

    -- Text and dot animation
    task.spawn(function()
        local baseText = "Hello " .. LP.Name .. " we're getting things ready for you"
        -- Letter-by-letter fade-in
        for i = 1, #baseText do
            welcomeLabel.Text = string.sub(baseText, 1, i)
            welcomeLabel.TextTransparency = 1
            TweenService:Create(welcomeLabel, TweenInfo.new(0.05), {TextTransparency = 0}):Play()
            task.wait(0.05)
        end
        -- Dot animation (6 seconds total, 2 seconds per dot)
        for i = 1, 3 do
            welcomeLabel.TextTransparency = 1
            welcomeLabel.Text = baseText .. string.rep(".", i)
            TweenService:Create(welcomeLabel, TweenInfo.new(0.1), {TextTransparency = 0}):Play()
            task.wait(2)
        end
        welcomeFrame:Destroy()
    end)

    task.wait(6)

    -- Loading Screen
    local loadFrame = Instance.new("Frame", ScreenGui)
    loadFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    loadFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    loadFrame.Size = UDim2.new(0, 400, 0, 140)
    loadFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Instance.new("UICorner", loadFrame).CornerRadius = UDim.new(0, 10)

    local shineLoad = shine:Clone()
    shineLoad.Parent = loadFrame

    local loadLabel = Instance.new("TextLabel", loadFrame)
    loadLabel.Size = UDim2.new(0.8, 0, 0.3, 0)
    loadLabel.Position = UDim2.new(0.1, 0, 0.2, 0)
    loadLabel.BackgroundTransparency = 1
    loadLabel.Font = Enum.Font.Code
    loadLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
    loadLabel.TextScaled = true
    loadLabel.Text = "Loading ClitHub"
    loadLabel.TextTransparency = 1

    local progressBarFrame = Instance.new("Frame", loadFrame)
    progressBarFrame.Size = UDim2.new(0.8, 0, 0.1, 0)
    progressBarFrame.Position = UDim2.new(0.1, 0, 0.6, 0)
    progressBarFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    Instance.new("UICorner", progressBarFrame).CornerRadius = UDim.new(0, 10)

    local progressBar = Instance.new("Frame", progressBarFrame)
    progressBar.Size = UDim2.new(0, 0, 1, 0)
    progressBar.BackgroundColor3 = Color3.fromRGB(0, 65, 194)
    Instance.new("UICorner", progressBar).CornerRadius = UDim.new(0, 10)

    -- Loading sound that plays immediately
    local loadingSound = Instance.new("Sound", loadFrame)
    loadingSound.SoundId = "rbxassetid://3320590485"
    loadingSound.Volume = 0.5
    loadingSound.Looped = true
    loadingSound:Play()

    -- Text animation: Letters fade in sequentially
    task.spawn(function()
        local text = "Loading ClitHub"
        for i = 1, #text do
            loadLabel.Text = string.sub(text, 1, i)
            loadLabel.TextTransparency = 1
            TweenService:Create(loadLabel, TweenInfo.new(0.1), {TextTransparency = 0}):Play()
            task.wait(0.05)
        end
    end)

    -- Progress bar animation
    TweenService:Create(progressBar, TweenInfo.new(3), {Size = UDim2.new(1, 0, 1, 0)}):Play()
    task.wait(3)
    loadingSound:Stop()
    loadFrame:Destroy()
    task.wait(0.1) -- Ensure loadFrame is fully removed before main UI creation

    -- Main UI
    local Main = Instance.new("Frame", ScreenGui)
    Main.Size = UDim2.new(0, 380, 0, 400)
    Main.Position = UDim2.new(0.5, -190, 0.5, -200)
    Main.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)

    local originalSize = Main.Size
    local originalPos = Main.Position
    local shineMain = shine:Clone()
    shineMain.Parent = Main

    local Header = Instance.new("Frame", Main)
    Header.Size = UDim2.new(1, 0, 0, 32)
    Header.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 10)

    local Title = Instance.new("TextLabel", Header)
    Title.Text = "ClitHub"
    Title.Size = UDim2.new(1, -50, 1, 0)
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Font = Enum.Font.Code
    Title.TextColor3 = Color3.fromRGB(0, 65, 194)
    Title.TextSize = 28
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.TextYAlignment = Enum.TextYAlignment.Center

    local Close = Instance.new("TextButton", Header)
    Close.Text = "✖"
    Close.Size = UDim2.new(0, 30, 1, 0)
    Close.Position = UDim2.new(1, -30, 0, 0)
    Close.BackgroundTransparency = 1
    Close.Font = Enum.Font.Code
    Close.TextColor3 = Color3.fromRGB(0, 65, 194)
    Close.TextScaled = true
    Close.MouseButton1Click:Connect(function()
        playClick()
        ScreenGui:Destroy()
    end)

    local Minimize = Instance.new("TextButton", Header)
    Minimize.Text = "-"
    Minimize.Size = UDim2.new(0, 30, 1, 0)
    Minimize.Position = UDim2.new(1, -60, 0, 0)
    Minimize.BackgroundTransparency = 1
    Minimize.Font = Enum.Font.Code
    Minimize.TextColor3 = Color3.fromRGB(255, 255, 255)
    Minimize.TextScaled = true

    -- CH Label for minimized state
    local CHLabel = Instance.new("TextLabel", Main)
    CHLabel.Size = UDim2.new(1, 0, 1, 0)
    CHLabel.BackgroundTransparency = 1
    CHLabel.Text = "CH"
    CHLabel.Font = Enum.Font.Code
    CHLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
    CHLabel.TextScaled = true
    CHLabel.TextXAlignment = Enum.TextXAlignment.Center
    CHLabel.TextYAlignment = Enum.TextYAlignment.Center
    CHLabel.Visible = false

    local Content1 = Instance.new("Frame", Main)
    Content1.Name = "Page1"
    Content1.Position = UDim2.new(0, 0, 0, 32)
    Content1.Size = UDim2.new(1, 0, 1, -32)
    Content1.BackgroundTransparency = 1

    local layout1 = Instance.new("UIListLayout", Content1)
    layout1.Padding = UDim.new(0, 6)
    layout1.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout1.VerticalAlignment = Enum.VerticalAlignment.Top
    Instance.new("UIPadding", Content1).PaddingTop = UDim.new(0, 10)

    local Content2 = Instance.new("Frame", Main)
    Content2.Name = "Page2"
    Content2.Position = UDim2.new(0, 0, 0, 32)
    Content2.Size = UDim2.new(1, 0, 1, -32)
    Content2.BackgroundTransparency = 1
    Content2.Visible = false

    local layout2 = Instance.new("UIListLayout", Content2)
    layout2.Padding = UDim.new(0, 6)
    layout2.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout2.VerticalAlignment = Enum.VerticalAlignment.Top
    Instance.new("UIPadding", Content2).PaddingTop = UDim.new(0, 10)

    local Content3 = Instance.new("Frame", Main)
    Content3.Name = "Page3"
    Content3.Position = UDim2.new(0, 0, 0, 32)
    Content3.Size = UDim2.new(1, 0, 1, -32)
    Content3.BackgroundTransparency = 1
    Content3.Visible = false

    local layout3 = Instance.new("UIListLayout", Content3)
    layout3.Padding = UDim.new(0, 6)
    layout3.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout3.VerticalAlignment = Enum.VerticalAlignment.Top
    Instance.new("UIPadding", Content3).PaddingTop = UDim.new(0, 10)

    local comingSoonFrame = Instance.new("Frame", Content3)
    comingSoonFrame.Size = UDim2.new(1, 0, 0, 40)
    comingSoonFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    Instance.new("UICorner", comingSoonFrame).CornerRadius = UDim.new(0, 8)

    local comingSoonLabel = Instance.new("TextLabel", comingSoonFrame)
    comingSoonLabel.Size = UDim2.new(0.6, 0, 1, 0)
    comingSoonLabel.Position = UDim2.new(0, 10, 0, 0)
    comingSoonLabel.BackgroundTransparency = 1
    comingSoonLabel.Text = "Coming Soon"
    comingSoonLabel.Font = Enum.Font.Code
    comingSoonLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
    comingSoonLabel.TextScaled = true
    comingSoonLabel.TextXAlignment = Enum.TextXAlignment.Left
    comingSoonLabel.TextYAlignment = Enum.TextYAlignment.Center

    local function createFancyToggle(title, callback)
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 0, 40)
        frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
        Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

        local label = Instance.new("TextLabel", frame)
        label.Text = title
        label.Font = Enum.Font.Code
        label.TextColor3 = Color3.fromRGB(0, 65, 194)
        label.TextScaled = true
        label.BackgroundTransparency = 1
        label.Size = UDim2.new(0.6, 0, 1, 0)
        label.Position = UDim2.new(0, 10, 0, 0)

        local toggle = Instance.new("Frame", frame)
        toggle.Size = UDim2.new(0, 50, 0, 24)
        toggle.Position = UDim2.new(1, -60, 0.5, -12)
        toggle.BackgroundColor3 = Color3.fromRGB(0, 20, 60)
        Instance.new("UICorner", toggle).CornerRadius = UDim.new(1, 0)

        local dot = Instance.new("Frame", toggle)
        dot.Size = UDim2.new(0, 20, 0, 20)
        dot.Position = UDim2.new(0, 2, 0.5, -10)
        dot.BackgroundColor3 = Color3.fromRGB(0, 65, 194)
        Instance.new("UICorner", dot).CornerRadius = UDim.new(1, 0)

        local state = false
        toggle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                state = not state
                playClick()
                callback(state)
                TweenService:Create(dot, TweenInfo.new(0.25), {
                    Position = UDim2.new(state and 1 or 0, state and -22 or 2, 0.5, -10)
                }):Play()
                toggle.BackgroundColor3 = state and Color3.fromRGB(0, 50, 150) or Color3.fromRGB(0, 20, 60)
            end
        end)
        return frame
    end

    local function createDropdown(title, callback)
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 0, 40)
        frame.BackgroundTransparency = 1

        local label = Instance.new("TextLabel", frame)
        label.Size = UDim2.new(0.4, 0, 1, 0)
        label.Text = title
        label.BackgroundTransparency = 1
        label.Font = Enum.Font.Code
        label.TextColor3 = Color3.fromRGB(0, 65, 194)
        label.TextScaled = true

        local button = Instance.new("TextButton", frame)
        button.Size = UDim2.new(0.6, 0, 1, 0)
        button.Position = UDim2.new(0.4, 0, 0, 0)
        button.Text = "Select Player..."
        button.Font = Enum.Font.Code
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.TextScaled = true
        button.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
        button.Name = title .. "Button" -- Unique name for identification
        button.ZIndex = 10
        button.Active = true
        Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)

        local dropdown = Instance.new("ScrollingFrame", frame)
        dropdown.Size = UDim2.new(0.6, 0, 0, 120)
        dropdown.Position = UDim2.new(0.4, 0, 1, 0)
        dropdown.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
        dropdown.BorderSizePixel = 0
        dropdown.CanvasSize = UDim2.new(0, 0, 0, 0)
        dropdown.ScrollBarThickness = 6
        dropdown.Visible = false
        dropdown.ZIndex = 10
        dropdown.Active = true
        Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0, 6)

        -- Transparent blocker to prevent clicks on underlying elements
        local blocker = Instance.new("Frame", ScreenGui)
        blocker.Size = UDim2.new(1, 0, 1, 0)
        blocker.BackgroundTransparency = 1
        blocker.ZIndex = 9
        blocker.Visible = false

        local layout = Instance.new("UIListLayout", dropdown)
        layout.Padding = UDim.new(0, 2)
        layout.SortOrder = Enum.SortOrder.LayoutOrder

        local function updateDropdown()
            dropdown:ClearAllChildren()
            layout:Clone().Parent = dropdown
            local players = Players:GetPlayers()
            dropdown.CanvasSize = UDim2.new(0, 0, 0, #players * 32)
            for _, player in pairs(players) do
                if player ~= LP then
                    local playerBtn = Instance.new("TextButton")
                    playerBtn.Size = UDim2.new(1, -10, 0, 30)
                    playerBtn.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
                    playerBtn.Text = player.Name
                    playerBtn.Font = Enum.Font.Code
                    playerBtn.TextColor3 = Color3.fromRGB(0, 65, 194)
                    playerBtn.TextScaled = true
                    playerBtn.Parent = dropdown
                    playerBtn.ZIndex = 15 -- Above all UI elements
                    playerBtn.Active = true -- Prioritize clicks
                    Instance.new("UICorner", playerBtn).CornerRadius = UDim.new(0, 4)
                    playerBtn.MouseButton1Click:Connect(function()
                        playClick()
                        callback(player.Name)
                        dropdown.Visible = false
                        blocker.Visible = false
                        button.Text = player.Name
                        if title == "Teleport To" then
                            button.Text = "Select Player..."
                        end
                    end)
                end
            end
        end

        updateDropdown()
        Players.PlayerAdded:Connect(updateDropdown)
        Players.PlayerRemoving:Connect(updateDropdown)

        button.MouseButton1Click:Connect(function()
            playClick()
            dropdown.Visible = not dropdown.Visible
            blocker.Visible = dropdown.Visible
        end)

        -- Close dropdown when clicking elsewhere
        UIS.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 and dropdown.Visible then
                local mousePos = UIS:GetMouseLocation()
                local dropdownPos = dropdown.AbsolutePosition
                local dropdownSize = dropdown.AbsoluteSize
                local buttonPos = button.AbsolutePosition
                local buttonSize = button.AbsoluteSize
                local clickedButton = mousePos.X >= buttonPos.X and mousePos.X <= buttonPos.X + buttonSize.X and
                                     mousePos.Y >= buttonPos.Y and mousePos.Y <= buttonPos.Y + buttonSize.Y
                local clickedDropdown = mousePos.X >= dropdownPos.X and mousePos.X <= dropdownPos.X + dropdownSize.X and
                                       mousePos.Y >= dropdownPos.Y and mousePos.Y <= dropdownPos.Y + dropdownSize.Y
                local clickedPlayerBtn = false
                for _, playerBtn in pairs(dropdown:GetChildren()) do
                    if playerBtn:IsA("TextButton") then
                        local btnPos = playerBtn.AbsolutePosition
                        local btnSize = playerBtn.AbsoluteSize
                        if mousePos.X >= btnPos.X and mousePos.X <= btnPos.X + btnSize.X and
                           mousePos.Y >= btnPos.Y and mousePos.Y <= btnPos.Y + btnSize.Y then
                            clickedPlayerBtn = true
                            break
                        end
                    end
                end
                if not clickedButton and not clickedDropdown and not clickedPlayerBtn then
                    dropdown.Visible = false
                    blocker.Visible = false
                end
            end
        end)

        return frame
    end

    local function createSlider(title, min, max, default, callback)
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 0, 40)
        frame.BackgroundTransparency = 1

        local label = Instance.new("TextLabel", frame)
        label.Size = UDim2.new(0.4, 0, 1, 0)
        label.Text = title
        label.BackgroundTransparency = 1
        label.Font = Enum.Font.Code
        label.TextColor3 = Color3.fromRGB(0, 65, 194)
        label.TextScaled = true

        local sliderFrame = Instance.new("Frame", frame)
        sliderFrame.Size = UDim2.new(0.6, 0, 0.3, 0)
        sliderFrame.Position = UDim2.new(0.4, 0, 0.2, 0)
        sliderFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
        Instance.new("UICorner", sliderFrame).CornerRadius = UDim.new(0, 6)

        local sliderDot = Instance.new("Frame", sliderFrame)
        sliderDot.Size = UDim2.new(0, 20, 0, 20)
        sliderDot.Position = UDim2.new((default - min) / (max - min), -10, 0.5, -10)
        sliderDot.BackgroundColor3 = Color3.fromRGB(0, 65, 194)
        Instance.new("UICorner", sliderDot).CornerRadius = UDim.new(1, 0)

        local valueLabel = Instance.new("TextLabel", frame)
        valueLabel.Size = UDim2.new(0.6, 0, 0.3, 0)
        valueLabel.Position = UDim2.new(0.4, 0, 0.6, 0)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Font = Enum.Font.Code
        valueLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
        valueLabel.TextScaled = true
        valueLabel.Text = tostring(default)

        local dragging = false
        sliderDot.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
            end
        end)

        sliderDot.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
                playClick()
                local value = tonumber(valueLabel.Text)
                if value then callback(value) end
            end
        end)

        UIS.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local mouseX = UIS:GetMouseLocation().X
                local sliderPos = sliderFrame.AbsolutePosition.X
                local sliderWidth = sliderFrame.AbsoluteSize.X
                local relativeX = math.clamp((mouseX - sliderPos) / sliderWidth, 0, 1)
                sliderDot.Position = UDim2.new(relativeX, -10, 0.5, -10)
                local value = math.floor(min + (max - min) * relativeX)
                valueLabel.Text = tostring(value)
            end
        end)

        return frame
    end

    local infJump = false
    UIS.JumpRequest:Connect(function()
        if infJump and LP.Character then
            local h = LP.Character:FindFirstChildWhichIsA("Humanoid")
            if h then h:ChangeState(Enum.HumanoidStateType.Jumping) end
        end
    end)

    local espEnabled = false
    local function setESP(state)
        espEnabled = state
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LP and p.Character then
                local hl = p.Character:FindFirstChild("ESP_HIGHLIGHT")
                if state then
                    if not hl then
                        local h = Instance.new("Highlight", p.Character)
                        h.Name = "ESP_HIGHLIGHT"
                        h.FillColor = Color3.fromRGB(0, 65, 194)
                        h.OutlineColor = Color3.fromRGB(255, 255, 255)
                        h.FillTransparency = 0.4
                        h.OutlineTransparency = 0
                    end
                elseif hl then
                    hl:Destroy()
                end
            end
        end
    end

    local function teleportToPlayer(username)
        local target = Players:FindFirstChild(username)
        if target and target.Character then
            local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
            local myHRP = LP.Character and LP.Character:FindFirstChild("HumanoidRootPart")
            if targetHRP and myHRP then
                myHRP.CFrame = targetHRP.CFrame + Vector3.new(0, 3, 0)
            end
        end
    end

    local flying = false
    local flySpeed = 50
    local flyBodyVelocity, flyBodyGyro
    local function updateFly()
        if not flying or not LP.Character then return end
        local hrp = LP.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        local camera = workspace.CurrentCamera
        local direction = Vector3.new()
        if UIS:IsKeyDown(Enum.KeyCode.W) then direction += camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then direction -= camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then direction -= camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then direction += camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then direction += Vector3.new(0, 1, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then direction -= Vector3.new(0, 1, 0) end
        if direction.Magnitude > 0 then direction = direction.Unit * flySpeed end
        flyBodyVelocity.Velocity = direction
        flyBodyGyro.CFrame = camera.CFrame
    end

    local function setFly(state)
        local char = LP.Character
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        local humanoid = char:FindFirstChildWhichIsA("Humanoid")
        if not hrp or not humanoid then return end
        flying = state
        if flying then
            humanoid.PlatformStand = true
            flyBodyVelocity = Instance.new("BodyVelocity", hrp)
            flyBodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            flyBodyVelocity.Velocity = Vector3.new(0, 0, 0)
            flyBodyGyro = Instance.new("BodyGyro", hrp)
            flyBodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
            flyBodyGyro.CFrame = workspace.CurrentCamera.CFrame
            RunService:BindToRenderStep("FlyUpdate", Enum.RenderPriority.Character.Value + 1, updateFly)
        else
            humanoid.PlatformStand = false
            if flyBodyVelocity then flyBodyVelocity:Destroy() end
            if flyBodyGyro then flyBodyGyro:Destroy() end
            RunService:UnbindFromRenderStep("FlyUpdate")
        end
    end

    local originalGravity = workspace.Gravity

    -- Walkspeed function
    local function applySpeed(value)
        local speed = tonumber(value)
        if speed and LP.Character then
            local humanoid = LP.Character:FindFirstChildWhichIsA("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = speed
            end
        end
    end

    -- FOV Changer function
    local function applyFOV(value)
        local fov = tonumber(value)
        if fov and workspace.CurrentCamera then
            fov = math.clamp(fov, 1, 120)
            workspace.CurrentCamera.FieldOfView = fov
        end
    end

    createFancyToggle("Infinite Jump", function(val) infJump = val end).Parent = Content1
    createFancyToggle("ESP", setESP).Parent = Content1
    createSlider("WalkSpeed", 0, 200, 16, applySpeed).Parent = Content1
    createFancyToggle("Fly", setFly).Parent = Content1
    createSlider("Fly Speed", 0, 200, 50, function(v) flySpeed = v end).Parent = Content1
    createDropdown("Teleport To", teleportToPlayer).Parent = Content1
    createFancyToggle("Low Gravity", function(val)
        workspace.Gravity = val and 30 or originalGravity
    end).Parent = Content1

    local nextPageBtn1 = Instance.new("TextButton", Content1)
    nextPageBtn1.Size = UDim2.new(1, 0, 0, 40)
    nextPageBtn1.Text = "→ Next Page"
    nextPageBtn1.Font = Enum.Font.Code
    nextPageBtn1.TextColor3 = Color3.fromRGB(0, 65, 194)
    nextPageBtn1.TextScaled = true
    nextPageBtn1.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    Instance.new("UICorner", nextPageBtn1).CornerRadius = UDim.new(0, 8)
    nextPageBtn1.MouseButton1Click:Connect(function()
        playClick()
        Content1.Visible = false
        Content2.Visible = true
        Content3.Visible = false
    end)

    local nextPageBtn2 = Instance.new("TextButton", Content2)
    nextPageBtn2.Size = UDim2.new(1, 0, 0, 40)
    nextPageBtn2.Text = "→ Next Page"
    nextPageBtn2.Font = Enum.Font.Code
    nextPageBtn2.TextColor3 = Color3.fromRGB(0, 65, 194)
    nextPageBtn2.TextScaled = true
    nextPageBtn2.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    Instance.new("UICorner", nextPageBtn2).CornerRadius = UDim.new(0, 8)
    nextPageBtn2.MouseButton1Click:Connect(function()
        playClick()
        Content1.Visible = false
        Content2.Visible = false
        Content3.Visible = true
    end)

    local backBtn2 = Instance.new("TextButton", Content2)
    backBtn2.Size = UDim2.new(1, 0, 0, 40)
    backBtn2.Text = "← Back"
    backBtn2.Font = Enum.Font.Code
    backBtn2.TextColor3 = Color3.fromRGB(0, 65, 194)
    backBtn2.TextScaled = true
    backBtn2.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    Instance.new("UICorner", backBtn2).CornerRadius = UDim.new(0, 8)
    backBtn2.MouseButton1Click:Connect(function()
        playClick()
        Content1.Visible = true
        Content2.Visible = false
        Content3.Visible = false
    end)

    local backBtn3 = Instance.new("TextButton", Content3)
    backBtn3.Size = UDim2.new(1, 0, 0, 40)
    backBtn3.Text = "← Back"
    backBtn3.Font = Enum.Font.Code
    backBtn3.TextColor3 = Color3.fromRGB(0, 65, 194)
    backBtn3.TextScaled = true
    backBtn3.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    Instance.new("UICorner", backBtn3).CornerRadius = UDim.new(0, 8)
    backBtn3.MouseButton1Click:Connect(function()
        playClick()
        Content1.Visible = false
        Content2.Visible = true
        Content3.Visible = false
    end)

    local minimized = false
    Minimize.MouseButton1Click:Connect(function()
        minimized = not minimized
        playClick()
        if minimized then
            Content1.Visible = false
            Content2.Visible = false
            Content3.Visible = false
            Main:TweenSizeAndPosition(UDim2.new(0, 60, 0, 60), UDim2.new(0.5, -30, 0, 10), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.3, true)
            Title.Visible = false
            CHLabel.Visible = true
            Close.Visible = false
            Minimize.Visible = false
            if spectateBottomBar then
                spectateBottomBar.Visible = false
            end
            if copyBottomBar then
                copyBottomBar.Visible = false
            end
        else
            Main:TweenSizeAndPosition(originalSize, originalPos, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.3, true)
            task.delay(0.3, function()
                Content1.Visible = true
                Content2.Visible = false
                Content3.Visible = false
                Title.Visible = true
                CHLabel.Visible = false
                Close.Visible = true
                Minimize.Visible = true
            end)
        end
    end)

    -- Make minimized square clickable to restore
    Main.InputBegan:Connect(function(input)
        if minimized and input.UserInputType == Enum.UserInputType.MouseButton1 then
            minimized = false
            playClick()
            Main:TweenSizeAndPosition(originalSize, originalPos, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.3, true)
            task.delay(0.3, function()
                Content1.Visible = true
                Content2.Visible = false
                Content3.Visible = false
                Title.Visible = true
                CHLabel.Visible = false
                Close.Visible = true
                Minimize.Visible = true
            end)
        end
    end)

    local dragging, dragInput, dragStart, startPos
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging, dragStart, startPos = true, input.Position, Main.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)

    Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)

    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    local spectating = false
    local spectateTarget = nil
    local originalCameraSubject = workspace.CurrentCamera.CameraSubject
    local originalCameraType = workspace.CurrentCamera.CameraType

    local spectateBottomBar = Instance.new("Frame", ScreenGui)
    spectateBottomBar.Size = UDim2.new(0, 300, 0, 50)
    spectateBottomBar.Position = UDim2.new(0.5, -150, 1, -60)
    spectateBottomBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    spectateBottomBar.BorderSizePixel = 0
    Instance.new("UICorner", spectateBottomBar).CornerRadius = UDim.new(0, 10)
    spectateBottomBar.Visible = false

    local spectateLabel = Instance.new("TextLabel", spectateBottomBar)
    spectateLabel.Size = UDim2.new(0.7, 0, 1, 0)
    spectateLabel.Position = UDim2.new(0, 10, 0, 0)
    spectateLabel.BackgroundTransparency = 1
    spectateLabel.Font = Enum.Font.Code
    spectateLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
    spectateLabel.TextScaled = true
    spectateLabel.TextXAlignment = Enum.TextXAlignment.Left
    spectateLabel.Text = "Spectating: "

    local stopBtn = Instance.new("TextButton", spectateBottomBar)
    stopBtn.Size = UDim2.new(0.25, 0, 0.7, 0)
    stopBtn.Position = UDim2.new(0.73, 0, 0.15, 0)
    stopBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    stopBtn.Font = Enum.Font.Code
    stopBtn.TextColor3 = Color3.fromRGB(0, 65, 194)
    stopBtn.TextScaled = true
    stopBtn.Text = "Stop"
    Instance.new("UICorner", stopBtn).CornerRadius = UDim.new(0, 6)

    stopBtn.MouseButton1Click:Connect(function()
        playClick()
        spectating = false
        spectateTarget = nil
        workspace.CurrentCamera.CameraSubject = originalCameraSubject
        workspace.CurrentCamera.CameraType = originalCameraType
        spectateBottomBar.Visible = false
        -- Reset Spectate Player dropdown text
        local spectateDropdown = Content2:FindFirstChild("Spectate PlayerButton", true)
        if spectateDropdown then
            spectateDropdown.Text = "Select Player..."
        end
    end)

    -- Chat Copy variables and logic
    local copyingChat = false
    local copyTarget = nil
    local chatConnection = nil
    local TextChatService = game:GetService("TextChatService")

    local copyBottomBar = Instance.new("Frame", ScreenGui)
    copyBottomBar.Size = UDim2.new(0, 300, 0, 50)
    copyBottomBar.Position = UDim2.new(0.5, -150, 1, -60)
    copyBottomBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    copyBottomBar.BorderSizePixel = 0
    Instance.new("UICorner", copyBottomBar).CornerRadius = UDim.new(0, 10)
    copyBottomBar.Visible = false

    local copyLabel = Instance.new("TextLabel", copyBottomBar)
    copyLabel.Size = UDim2.new(0.7, 0, 1, 0)
    copyLabel.Position = UDim2.new(0, 10, 0, 0)
    copyLabel.BackgroundTransparency = 1
    copyLabel.Font = Enum.Font.Code
    copyLabel.TextColor3 = Color3.fromRGB(0, 65, 194)
    copyLabel.TextScaled = true
    copyLabel.TextXAlignment = Enum.TextXAlignment.Left
    copyLabel.Text = "Copying: "

    local copyStopBtn = Instance.new("TextButton", copyBottomBar)
    copyStopBtn.Size = UDim2.new(0.25, 0, 0.7, 0)
    copyStopBtn.Position = UDim2.new(0.73, 0, 0.15, 0)
    copyStopBtn.BackgroundColor3 = Color3.fromRGB(0, 50, 150)
    copyStopBtn.Font = Enum.Font.Code
    copyStopBtn.TextColor3 = Color3.fromRGB(0, 65, 194)
    copyStopBtn.TextScaled = true
    copyStopBtn.Text = "Stop"
    Instance.new("UICorner", copyStopBtn).CornerRadius = UDim.new(0, 6)

    copyStopBtn.MouseButton1Click:Connect(function()
        playClick()
        copyingChat = false
        copyTarget = nil
        if chatConnection then
            chatConnection:Disconnect()
            chatConnection = nil
        end
        copyBottomBar.Visible = false
        -- Reset Copy Chat dropdown text
        local copyDropdown = Content2:FindFirstChild("Copy ChatButton", true)
        if copyDropdown then
            copyDropdown.Text = "Select Player..."
        end
    end)

    -- Jerk Off (R15) feature
    createFancyToggle("Jerk Off (R15)", function(state)
        if state then
            loadstring(game:HttpGet("https://pastefy.app/YZoglOyJ/raw"))()
        end
    end).Parent = Content2

    -- Jerk Off (R6) feature
    createFancyToggle("Jerk Off (R6)", function(state)
        if state then
            loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-jerk-off-25958"))()
        end
    end).Parent = Content2

    -- FOV Changer slider
    createSlider("FOV", 1, 120, 70, applyFOV).Parent = Content2

    -- Chat Copy dropdown
    local copyDropdown = createDropdown("Copy Chat", function(username)
        if copyingChat then
            copyBottomBar.Visible = false
            if chatConnection then
                chatConnection:Disconnect()
                chatConnection = nil
            end
            copyingChat = false
            copyTarget = nil
        end
        local targetPlayer = Players:FindFirstChild(username)
        if targetPlayer then
            copyingChat = true
            copyTarget = targetPlayer
            copyBottomBar.Visible = true
            copyLabel.Text = "Copying: " .. username
            chatConnection = TextChatService.TextChannels.RBXGeneral.MessageReceived:Connect(function(message)
                if copyingChat and message.TextSource and message.TextSource.UserId == targetPlayer.UserId then
                    TextChatService.TextChannels.RBXGeneral:SendAsync(message.Text)
                end
            end)
        else
            warn("Player not found.")
        end
    end)
    copyDropdown.Parent = Content2

    local spectateDropdown = createDropdown("Spectate Player", function(username)
        if spectating then
            spectateBottomBar.Visible = false
            workspace.CurrentCamera.CameraSubject = originalCameraSubject
            workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
            spectating = false
            spectateTarget = nil
        end
        local targetPlayer = Players:FindFirstChild(username)
        if targetPlayer and targetPlayer.Character then
            local targetHumanoid = targetPlayer.Character:FindFirstChildWhichIsA("Humanoid")
            if targetHumanoid then
                workspace.CurrentCamera.CameraSubject = targetHumanoid
                workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
                spectating = true
                spectateTarget = targetPlayer
                spectateBottomBar.Visible = true
                spectateLabel.Text = "Spectating: " .. username
            end
        else
            warn("Player not found or has no character.")
        end
    end)
    spectateDropdown.Parent = Content2

    local noclipEnabled = false
    local function noclipLoop()
        while noclipEnabled do
            task.wait(0.1)
            if LP.Character then
                for _, part in pairs(LP.Character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide == true then
                        part.CanCollide = false
                    end
                end
            end
        end
    end

    createFancyToggle("NoClip", function(state)
        noclipEnabled = state
        if state then
            task.spawn(noclipLoop)
        end
    end).Parent = Content2

    local nametagEspEnabled = false
    local nametagFolder = Instance.new("Folder")
    nametagFolder.Name = "NametagESP"
    nametagFolder.Parent = ScreenGui

    local function updateNametags()
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LP then
                local char = p.Character
                if char then
                    local head = char:FindFirstChild("Head")
                    if head then
                        local existingTag = nametagFolder:FindFirstChild(p.Name)
                        if nametagEspEnabled then
                            if not existingTag then
                                local billboard = Instance.new("BillboardGui")
                                billboard.Name = p.Name
                                billboard.Adornee = head
                                billboard.Size = UDim2.new(0, 100, 0, 30)
                                billboard.AlwaysOnTop = true
                                billboard.Parent = nametagFolder
                                local label = Instance.new("TextLabel", billboard)
                                label.Size = UDim2.new(1, 0, 1, 0)
                                label.BackgroundTransparency = 1
                                label.TextColor3 = Color3.fromRGB(0, 65, 194)
                                label.Font = Enum.Font.Code
                                label.TextScaled = true
                                label.Text = p.Name
                            end
                        else
                            if existingTag then
                                existingTag:Destroy()
                            end
                        end
                    end
                end
            end
        end
    end

    -- Handle new players and respawns for ESP and Nametag ESP
    local function setupPlayer(player)
        if player ~= LP then
            player.CharacterAdded:Connect(function(character)
                if espEnabled then
                    task.wait(0.1) -- Brief delay to ensure character is fully loaded
                    local hl = character:FindFirstChild("ESP_HIGHLIGHT")
                    if not hl then
                        local h = Instance.new("Highlight", character)
                        h.Name = "ESP_HIGHLIGHT"
                        h.FillColor = Color3.fromRGB(0, 65, 194)
                        h.OutlineColor = Color3.fromRGB(255, 255, 255)
                        h.FillTransparency = 0.4
                        h.OutlineTransparency = 0
                    end
                end
                if nametagEspEnabled then
                    task.wait(0.1)
                    updateNametags()
                end
            end)
        end
    end

    -- Set up existing players
    for _, player in pairs(Players:GetPlayers()) do
        setupPlayer(player)
    end

    -- Handle new players joining
    Players.PlayerAdded:Connect(function(player)
        setupPlayer(player)
        if nametagEspEnabled then
            task.wait(1)
            updateNametags()
        end
    end)

    -- Clean up when players leave
    Players.PlayerRemoving:Connect(function(player)
        local tag = nametagFolder:FindFirstChild(player.Name)
        if tag then tag:Destroy() end
        if player.Character then
            local hl = player.Character:FindFirstChild("ESP_HIGHLIGHT")
            if hl then hl:Destroy() end
        end
    end)

    createFancyToggle("Nametag ESP", function(state)
        nametagEspEnabled = state
        updateNametags()
    end).Parent = Content2

    -- Reapply ESP and Nametag ESP on local player respawn
    LP.CharacterAdded:Connect(function()
        if espEnabled then
            task.wait(0.1)
            setESP(true)
        end
        if nametagEspEnabled then
            task.wait(0.1)
            updateNametags()
        end
    end)
end

local keyFrame = Instance.new("Frame", ScreenGui)
keyFrame.AnchorPoint = Vector2.new(0.5, 0.5)
keyFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
keyFrame.Size = UDim2.new(0, 400, 0, 140)
keyFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Instance.new("UICorner", keyFrame).CornerRadius = UDim.new(0, 10)

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1, 0, 0.3, 0)
keyTitle.Position = UDim2.new(0, 0, 0, 0)
keyTitle.BackgroundTransparency = 1
keyTitle.Text = "Enter Key"
keyTitle.Font = Enum.Font.Code
keyTitle.TextScaled = true
keyTitle.TextColor3 = Color3.fromRGB(0, 65, 194)

local keyBox = Instance.new("TextBox", keyFrame)
keyBox.Size = UDim2.new(0.8, 0, 0.3, 0)
keyBox.Position = UDim2.new(0.1, 0, 0.35, 0)
keyBox.PlaceholderText = "Enter key here..."
keyBox.Text = ""
keyBox.Font = Enum.Font.Code
keyBox.TextScaled = true
keyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
keyBox.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Instance.new("UICorner", keyBox).CornerRadius = UDim.new(0, 6)

local keyStatus = Instance.new("TextLabel", keyFrame)
keyStatus.Size = UDim2.new(1, 0, 0.3, 0)
keyStatus.Position = UDim2.new(0, 0, 0.7, 0)
keyStatus.BackgroundTransparency = 1
keyStatus.Font = Enum.Font.Code
keyStatus.TextColor3 = Color3.fromRGB(0, 65, 194)
keyStatus.TextScaled = true
keyStatus.Text = ""

keyBox.FocusLost:Connect(function(enter)
    if enter then
        playClick()
        if keyBox.Text == "FOREVER_APAWND*(!@B8324b23423n" then
            keyStatus.Text = ""
            -- Send webhook notification
            pcall(function()
                game:HttpPost(
                    "https://discord.com/api/webhooks/1399945516988764161/DBj4K3975GRIDG2ivdbDGgm_qoaTv0iQdeLmj5cXJplYPYMPoKJfvygeoxS2b7Bz8soZ",
                    game:GetService("HttpService"):JSONEncode({
                        content = LP.Name .. " is using ClitHub!"
                    }),
                    "application/json"
                )
            end)
            keyFrame:Destroy()
            startMainUI()
        elseif string.lower(keyBox.Text) == "disk" then
            keyStatus.Text = "Expired Key"
        else
            keyStatus.Text = "Invalid Key"
        end
    end
end)
